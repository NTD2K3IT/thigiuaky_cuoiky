name: Deploy to Server

# Chạy quá trình deploy khi có push lên nhánh main
on:
  push:
    branches:
      - master  # Chỉ deploy khi có thay đổi ở nhánh main

jobs:
  deploy:
    runs-on: ubuntu-latest  # Chạy trên môi trường Ubuntu mới nhất

    steps:
    # Bước 1: Kiểm tra mã nguồn từ GitHub repository
    - name: Checkout code
      uses: actions/checkout@v2  # Dùng action để checkout mã nguồn

    # Bước 2: Cài đặt FTP client (lftp) trên server để sao chép file
    - name: Set up FTP client
      run: sudo apt-get install -y lftp  # Cài đặt công cụ lftp

    # Bước 3: Kiểm tra xem thư mục local_dir có tồn tại không (Nếu bạn cần kiểm tra thư mục cụ thể)
    - name: Check if local directory exists
      run: |
        pwd  # In ra đường dẫn hiện tại
        ls -R  # Liệt kê tất cả các thư mục và tệp trong thư mục làm việc
        # Kiểm tra thư mục local_dir nếu bạn tạo thư mục này trong tương lai
        if [ -d "./local_dir" ]; then
          echo "local_dir exists"
        else
          echo "local_dir does not exist"
        fi

    # Bước 4: Deploy mã nguồn lên server qua FTP
    - name: Deploy to server via FTP
      run: |
        echo "FTP_USER: $FTP_USER"
        echo "FTP_SERVER: $FTP_SERVER"
        lftp -u $FTP_USER,$FTP_PASSWORD $FTP_SERVER <<EOF
        mirror -R ./ /wwwroot  # Sao chép mã nguồn từ thư mục hiện tại lên server (thư mục đích trên server)
        quit
        EOF
      env:
        FTP_USER: ${{ secrets.FTP_USERNAME }}  # Lấy thông tin người dùng FTP từ Secrets
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}  # Lấy thông tin mật khẩu FTP từ Secrets
        FTP_SERVER: ${{ secrets.FTP_SERVER }}  # Lấy thông tin máy chủ FTP từ Secrets
