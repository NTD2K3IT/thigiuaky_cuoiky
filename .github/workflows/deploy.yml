name: Deploy to Server

# Chạy quá trình deploy khi có push lên nhánh main
on:
  push:
    branches:
      - main  # Chỉ deploy khi có thay đổi ở nhánh main

# Các bước thực hiện trong quá trình deploy
jobs:
  deploy:
    runs-on: ubuntu-latest  # Chạy trên môi trường Ubuntu mới nhất

    steps:
    # Bước 1: Kiểm tra mã nguồn từ GitHub repository
    - name: Checkout code
      uses: actions/checkout@v2  # Dùng action để checkout mã nguồn

    # Bước 2: Cài đặt FTP client (lftp) trên server để sao chép file
    - name: Set up FTP client
      run: sudo apt-get install lftp  # Cài đặt công cụ lftp

    # Bước 3: Deploy mã nguồn lên server qua FTP
    - name: Deploy to server via FTP
      run: |
        lftp -u $FTP_USER,$FTP_PASSWORD $FTP_SERVER <<EOF
        mirror -R ./local_dir /remote_dir  # Sao chép mã nguồn từ local lên server
        quit
        EOF
      env:
        FTP_USER: ${{ secrets.FTP_USER }}  # Lấy thông tin người dùng FTP từ Secrets
        FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}  # Lấy thông tin mật khẩu FTP từ Secrets
        FTP_SERVER: ${{ secrets.FTP_SERVER }}  # Lấy thông tin máy chủ FTP từ Secrets
